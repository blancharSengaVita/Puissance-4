var d=Object.defineProperty;var u=(h,t,e)=>t in h?d(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var s=(h,t,e)=>(u(h,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();class g{constructor(t,e){s(this,"_height");s(this,"_width");s(this,"canvasElement");s(this,"ctx");s(this,"autoDimension");this.canvasElement=t,e!==void 0?(this.height=e.height,this.width=e.width):(this.autoDimension=!0,this.width=innerWidth,this.height=window.innerHeight),this.ctx=this.canvasElement.getContext("2d"),(this.autoDimension||this.autoDimension)&&window.addEventListener("resize",()=>{this.autoDimension&&(this.height=innerHeight,this.width=innerWidth)})}set height(t){t>0&&(this._height=t,this.canvasElement.height=t)}set width(t){t>0&&(this._width=t,this.canvasElement.width=t)}get height(){return this._height}get width(){return this._width}clear(){this.ctx.clearRect(0,0,this.width,this.height)}}const i={cells:{color:"mintcream",radius:40},grid:{numberOfRow:6,numberOfItemPerRow:7,gap:20,margin:10},canvas:{selector:"#canvas"},dimensions:{height:600,width:700},player:{color:"yellow",text:{win:"Jaune a gagné"}},computer:{color:"red",text:{win:"Rouge a gagné"}},gameTied:{text:"Match nul"},startGame:{text:"Appuyer sur start pour commencer",button:{text:"Start"}},resetGame:{form:{selector:".game__container--reset"},button:{selector:".actions-container__reset-button",text:"Reset"},paragraph:{selector:".reset__text"}}};class m{constructor(t,e,r){s(this,"red");s(this,"green");s(this,"blue");s(this,"toString",()=>`rgb(${this.red},${this.green},${this.blue})`);this.red=t,this.green=e,this.blue=r}}class f{constructor(t){s(this,"ctx");s(this,"position");s(this,"speed");s(this,"direction");s(this,"color");s(this,"canvas");if(t.canvas===void 0)throw EvalError("The canvas must be defined");this.canvas=t.canvas,this.ctx=this.canvas.ctx,this.position=t.position.y&&t.position.x?t.position:{x:0,y:0},this.color=t.color!==void 0||t.color!==void 0?t.color:new m(250,0,0),this.speed=t.speed!=null&&t.speed>0?t.speed:1,this.direction=t.direction>0?t.direction:Math.random()*Math.PI*2}}class p extends f{constructor(e){super(e);s(this,"radius");this.radius=e.radius}draw(){this.ctx.beginPath(),this.ctx.fillStyle=`${this.color}`,this.ctx.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.closePath()}update(){const e=Math.trunc(this.position.x+this.speed*Math.cos(this.direction)),r=Math.trunc(this.position.y+this.speed*Math.sin(this.direction));(e+this.radius>=this.canvas.width||e-this.radius<=0)&&(this.direction=Math.PI-this.direction),(r+this.radius>=this.canvas.height||r-this.radius<=0)&&(this.direction=-this.direction),this.position.x+=Math.trunc(this.speed*Math.cos(this.direction)),this.position.y+=Math.trunc(this.speed*Math.sin(this.direction))}setDirectionByMousePosition(e){this.direction=Math.atan2(e.y-this.position.y,e.x-this.position.x)}clear(){throw new Error("Method not implemented.")}}class w extends p{constructor(e,r,o,n){super({canvas:e,color:void 0,position:r,radius:i.cells.radius});s(this,"owner");s(this,"highlight");s(this,"left");s(this,"right");s(this,"bot");s(this,"top");s(this,"winner");s(this,"row");s(this,"col");this.owner=null,this.highlight=null,this.winner=!1,this.left=this.position.x-i.cells.radius-i.grid.gap/2,this.right=this.position.x+i.cells.radius+i.grid.gap/2,this.top=this.position.y-i.cells.radius-i.grid.gap/2,this.bot=this.position.y+i.cells.radius+i.grid.gap/2,this.col=n,this.row=o}mouseOnCell({x:e,y:r}){return e>=this.left&&e<=this.right&&r>=this.top&&r<=this.bot}draw(){this.color=this.owner==null?i.cells.color:this.owner?i.player.color:i.computer.color,this.ctx.beginPath(),this.ctx.fillStyle=this.owner===null?i.cells.color:this.owner?i.player.color:i.computer.color,this.ctx.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.closePath(),(this.winner||this.highlight!==null)&&(this.color=this.winner?"orange":this.highlight?i.player.color:i.computer.color,this.ctx.lineWidth=i.cells.radius/1.5,this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.arc(this.position.x,this.position.y,i.cells.radius/4,0,Math.PI*2),this.ctx.stroke())}}class x{constructor(t,e,r,o,n,a){s(this,"grid");s(this,"canvas");s(this,"player");s(this,"gameStatus");s(this,"gameTied");s(this,"resetForm");s(this,"resetButton");this.canvas=t,this.gameStatus=e,this.resetForm=n,this.resetButton=a,this.grid=[],this.player=r,this.gameTied=o,this.createGrid()}clear(){}draw(){this.grid.forEach(t=>{t.forEach(e=>{e.draw()})})}update(){}createGrid(){for(let t=0;t<i.grid.numberOfRow;t++){const e=[];this.grid.push(e);for(let r=0;r<i.grid.numberOfItemPerRow;r++)e.push(new w(this.canvas,{x:i.grid.margin+i.cells.radius+i.cells.radius*2*r+i.grid.gap*r,y:i.grid.margin+i.cells.radius+i.cells.radius*2*t+i.grid.gap*t},t,r))}}addEventListener(){document.querySelector(i.canvas.selector).addEventListener("mousemove",t=>{this.highlightCell({x:t.offsetX,y:t.offsetY})}),document.querySelector(i.canvas.selector).addEventListener("click",()=>{this.gameStatus.start!==!1&&this.selectCell()})}highlightCell({x:t,y:e}){let r;this.grid.forEach(o=>{o.forEach(n=>{n.highlight=null,n.mouseOnCell({x:t,y:e})&&(r=n.col)})});for(let o=i.grid.numberOfRow-1;o>=0;o--)if(this.grid[o][r].owner===null)return this.grid[o][r].highlight=this.player.turn,this.grid[o][r]}selectCell(){let t=!1;if(this.grid.forEach(e=>{e.forEach(r=>{if(r.highlight!==null){t=!0,r.highlight=null,r.owner=this.player.turn,this.checkWin(r.row,r.col)&&(this.gameStatus.start=!1);return}})}),this.gameStatus.start===!0){this.gameTied.status=!0;t:for(const e of this.grid)for(const r of e)if(r.owner===null){this.gameTied.status=!1;break t}this.gameTied.status&&(this.gameStatus.start=!1,document.querySelector(`${i.resetGame.form.selector} p`).textContent=i.gameTied.text,this.resetButton.textContent=i.resetGame.button.text,this.resetForm.classList.remove("hidden"))}t&&this.gameStatus.start&&(this.player.turn=!this.player.turn)}checkWin(t,e){let r=[],o=[],n=[],a=[];for(let c=0;c<i.grid.numberOfRow;c++)for(let l=0;l<i.grid.numberOfItemPerRow;l++)c==t&&n.push(this.grid[c][l]),l==e&&a.push(this.grid[c][l]),c-l==t-e&&r.push(this.grid[c][l]),c+l==t+e&&o.push(this.grid[c][l]);return this.connect4(r)||this.connect4(o)||this.connect4(n)||this.connect4(a)}connect4(t){let e=0,r=null,o=[];for(let n=0;n<t.length;n++)if(t[n].owner===null?(e=0,o=[]):t[n].owner===r?(e++,o.push(t[n])):(e=1,o=[],o.push(t[n]),r=t[n].owner),e===4){for(const a of o)a.winner=!0,this.gameStatus.start=!this.gameStatus.start,a.draw();return document.querySelector(`${i.resetGame.form.selector} p`).textContent=this.player.turn?i.player.text.win:i.computer.text.win,this.resetButton.textContent=i.resetGame.button.text,this.resetForm.classList.remove("hidden"),!0}return!1}reset(){this.grid=[],this.createGrid()}}class y{constructor(t){s(this,"animated");s(this,"gameStatus");this.gameStatus=t,this.animated=[]}start(){this.animate()}registerForAnimation(t){this.animated.push(t)}animate(){console.log(this.gameStatus.start),this.gameStatus.start&&(this.animated.forEach(t=>{t.clear(),t.update(),t.draw()}),requestAnimationFrame(this.animate.bind(this)))}}class v{constructor(){s(this,"canvas");s(this,"grid");s(this,"animation");s(this,"gameStatus");s(this,"player");s(this,"gameTied");s(this,"resetButton");s(this,"resetForm");this.resetButton=document.querySelector(i.resetGame.button.selector),this.resetForm=document.querySelector(i.resetGame.form.selector),this.gameStatus={start:!1},this.player={turn:!1},this.gameTied={status:!1},this.canvas=new g(document.querySelector(i.canvas.selector),{width:i.dimensions.width,height:i.dimensions.height}),this.resetForm.insertAdjacentHTML("afterbegin",`<p class="reset__text">${i.startGame.text}</p>`),this.resetButton.textContent=i.startGame.button.text,this.grid=new x(this.canvas,this.gameStatus,this.player,this.gameTied,this.resetForm,this.resetButton),this.grid.draw(),this.animation=new y(this.gameStatus),this.animation.registerForAnimation(this.grid),this.addEventListener()}addEventListener(){this.player.turn=Math.random()>.5,this.resetForm.addEventListener("submit",t=>{t.preventDefault(),this.grid.reset(),this.resetForm.classList.add("hidden"),this.gameStatus.start=!0,this.grid.addEventListener(),this.animation.start()})}}new v;
